# Система управления компьютерным клубом
## Структура проекта
```bash
computer-club/
├── cmd/                  # Точка входа в приложение
│   ├── server/           # Основной серверный код
├── config/               # Конфигурационные файлы
├── internal/             # Основная бизнес-логика
│   ├── delivery/         # Внешний слой: контроллеры API
│   │   ├── httpService/  # HTTP-обработчики
│   ├── errors/           # Определение ошибок проекта
│   ├── logger/           # Логирование
│   ├── middleware/       # Middleware-фильтры
│   ├── models/           # Определения структур данных
│   ├── repository/       # Доступ к базе данных
│   ├── usecase/          # Реализация бизнес-логики
├── pkg/                  # Вспомогательные пакеты
├── test/                 # Тесты проекта
├── .env                  # Файл переменных окружения
├── docker-compose.yml     # Конфигурация Docker Compose
├── Dockerfile            # Docker-образ для сервиса
├── go.mod                # Файл зависимостей Go
```

## Описание проекта
Система управления компьютерным клубом — это сервис, разработанный на Go с использованием gRPC, предназначенный для автоматизации и управления работой компьютерного клуба. Проект построен на принципах Чистой архитектуры (Clean Architecture) и включает ключевые компоненты, такие как логирование, кэширование с использованием Redis и административную панель.

## Функциональные возможности
- **Управление пользователями**: регистрация, аутентификация и управление учетными записями пользователей.
- **Управление сеансами**: контроль времени сеанса, отслеживание активности пользователей.
- **Биллинг и расчёт стоимости**: автоматический расчёт стоимости игрового времени и управление платежами.
- **gRPC API**: эффективный механизм взаимодействия между клиентами и сервером.
- **Кэширование с Redis**: ускорение работы сервиса за счёт хранения часто используемых данных в Redis.
- **Административная панель**: удобный интерфейс для управления работой клуба.
- **Логирование**: структурированное логирование для удобного мониторинга и отладки.

## Используемые технологии
- **Go**: основной язык программирования для бэкенд-части проекта.
- **gRPC**: высокопроизводительный RPC-фреймворк для связи между клиентами и сервером.
- **PostgreSQL**: основная реляционная база данных для хранения данных клуба.
- **Redis**: система кэширования для ускорения работы сервиса.
- **Docker**: контейнеризация сервиса для удобного развертывания.
- **Чистая архитектура**: разделение компонентов системы для обеспечения масштабируемости и удобства поддержки.

## Установка и запуск

### Требования
Перед установкой убедитесь, что у вас установлены следующие компоненты:
- **Go** (последняя версия)
- **Docker и Docker Compose**
- **PostgreSQL**
- **Redis**

### Инструкция по установке
1. **Клонируйте репозиторий:**
   ```sh
   git clone https://github.com/Donilwel/computer-club.git
   cd computer-club
   ```
2. **Соберите и запустите сервис с помощью Docker Compose:**
   ```sh
   docker-compose up --build
   ```
3. **Сервис gRPC будет запущен и готов к работе.**

## Использование API

### **Пользовательские эндпоинты**

#### **Регистрация пользователя** (`POST /register`)
- **Описание**: Создаёт нового пользователя.
- **Входные параметры**:
  ```json
  {
    "name": "Иван",
    "email": "ivan@example.com",
    "password": "securepass",
    "role": "customer"
  }
  ```
- **Ответ**:
  ```json
  {
    "id": 1,
    "name": "Иван",
    "email": "ivan@example.com",
    "role": "customer"
  }
  ```
- **Ошибки**:
    - `400 Bad Request` – некорректные данные.
    - `409 Conflict` – пользователь уже существует.

#### **Авторизация пользователя** (`POST /login`)
- **Описание**: Позволяет пользователю войти и получить токен.
- **Входные параметры**:
  ```json
  {
    "email": "ivan@example.com",
    "password": "securepass"
  }
  ```
- **Ответ**:
  ```json
  {
    "token": "jwt_token_here"
  }
  ```
- **Ошибки**:
    - `401 Unauthorized` – неверные учетные данные.

#### **Получение информации о пользователе** (`GET /info`)
- **Описание**: Возвращает данные о текущем пользователе.
- **Ответ**:
  ```json
  {
    "id": 1,
    "name": "Иван",
    "balance": 100.50,
    "active_session": false
  }
  ```
- **Ошибки**:
    - `401 Unauthorized` – неавторизованный запрос.

### **Игровые сессии**

#### **Начало игровой сессии** (`POST /session/start`)
- **Описание**: Запускает игровую сессию для пользователя.
- **Входные параметры**:
  ```json
  {
    "pc_number": 5,
    "tariff_id": 2
  }
  ```
- **Ответ**:
  ```json
  {
    "session_id": 10,
    "start_time": "2024-03-07T12:00:00Z"
  }
  ```
- **Ошибки**:
    - `403 Forbidden` – недостаточно средств.
    - `409 Conflict` – компьютер занят.

#### **Завершение игровой сессии** (`POST /session/end`)
- **Описание**: Завершает текущую игровую сессию.
- **Входные параметры**:
  ```json
  {
    "session_id": 10
  }
  ```
- **Ответ**:
  ```json
  {
    "message": "Session ended successfully"
  }
  ```
- **Ошибки**:
    - `400 Bad Request` – некорректный ID сессии.
    - `404 Not Found` – сессия не найдена.

### **Статус компьютеров и тарифы**

#### **Получение списка тарифов** (`GET /tariff`)
- **Описание**: Возвращает список всех тарифов.
- **Ответ**:
  ```json
  [
    { "id": 1, "name": "Часовой", "price_per_hour": 100 },
    { "id": 2, "name": "Ночной", "price_per_hour": 500 }
  ]
  ```

#### **Получение статуса компьютеров** (`GET /computers/status`)
- **Описание**: Возвращает текущий статус всех компьютеров в клубе.
- **Ответ**:
  ```json
  [
    { "computer_id": 1, "status": "available" },
    { "computer_id": 2, "status": "occupied", "current_user": 3 }
  ]
  ```


## Ошибки API
Список возможных ошибок, которые могут возникнуть при работе с API:

- **Аутентификация и авторизация**:
    - `ErrUserNotFound` – пользователь не найден.
    - `ErrForbidden` – доступ запрещён (необходима роль администратора).
    - `ErrWrongIDFromJWT` – неверный идентификатор пользователя в токене.
    - `ErrWrongRoleFromJWT` – некорректная роль в токене.
    - `ErrInvalidCredentials` – неверные email или пароль.
    - `ErrTokenGeneration` – ошибка генерации токена.
    - `ErrMissingToken` – токен отсутствует в заголовке запроса.
    - `ErrWrongToken` – неверный токен.

- **Регистрация пользователей**:
    - `ErrUserAlreadyExists` – пользователь уже зарегистрирован.
    - `ErrUsernameTaken` – пользователь с таким никнеймом уже существует.
    - `ErrInvalidRole` – некорректная роль пользователя.
    - `ErrNameEmpty` – имя не может быть пустым.
    - `ErrEmailEmpty` – почта не может быть пустой.
    - `ErrPasswordEmpty` – пароль не может быть пустым.
    - `ErrPasswordTooShort` – пароль должен содержать минимум 6 символов.
    - `ErrHashedPassword` – ошибка при хешировании пароля.
    - `ErrRegistration` – ошибка регистрации пользователя.

- **Игровые сессии**:
    - `ErrSessionNotFound` – сессия не найдена.
    - `ErrSessionActive` – у пользователя уже есть активная сессия.
    - `ErrPCBusy` – компьютер уже занят.
    - `ErrInvalidSessionID` – некорректный идентификатор сессии.
    - `ErrCreatedSession` – ошибка при создании сессии в базе данных.
    - `ErrUpdateSession` – ошибка обновления сессии в базе данных.

- **Компьютеры и тарифы**:
    - `ErrFindComputer` – ошибка при поиске компьютера в базе данных.
    - `ErrComputerNotFound` – компьютер не найден.
    - `ErrUpdateComputerStatus` – ошибка обновления статуса компьютера.
    - `ErrFindTariffs` – ошибка поиска тарифов в базе данных.
    - `ErrFindTariffByID` – ошибка поиска тарифа по ID.
    - `ErrInvalidTariffID` – некорректный идентификатор тарифа.
    - `ErrTariffNotFound` – тариф не найден.

- **Финансовые операции**:
    - `ErrInvalidAmount` – сумма должна быть больше нуля.
    - `ErrInsufficientFunds` – недостаточно средств на балансе.
    - `ErrToDeposit` – ошибка при пополнении баланса.
    - `ErrCheckBalance` – ошибка проверки баланса.
    - `ErrCheckTransaction` – ошибка при просмотре транзакций в базе данных.
    - `ErrWithdraw` – ошибка при выводе средств.
    - `ErrWalletAlreadyExists` – кошелек уже существует.
    - `ErrCreateWallet` – ошибка при создании кошелька.
    - `ErrCommitData` – ошибка сохранения данных в базе данных.